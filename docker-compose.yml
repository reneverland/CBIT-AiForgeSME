# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# CBIT-FrontAiForge Docker Compose 配置
# 
# v4.0 新特性:
# - 全新UI设计（未来感校园助手界面）
# - Logo + CBIT文字（Pacifico字体）
# - 深色导航栏 + 模型徽章 "CBIT-Elite v 4.0"
# - 消息气泡设计（小字体，紫色+白色）
# - 反馈机制（👍 👎 按钮）
# - Footer（GitHub徽章 + CBIT开发标识 + 免责声明）
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

services:
  frontaiforge:
    build:
      context: .
      dockerfile: Dockerfile.host
    container_name: cbit_frontaiforge
    network_mode: "host"  # 使用宿主机网络模式
    restart: unless-stopped
    
    # 环境变量配置
    # 默认使用 .env.local（局域网环境）
    # 部署到外部服务器时，使用: docker-compose --env-file .env.production up -d
    env_file:
      - .env.local
    
    # 也可以直接在这里指定（会覆盖env_file）
    # environment:
    #   - BACKEND_API_URL=http://127.0.0.1:9300
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9200/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s  # 给予30秒启动时间

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 使用说明
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 
# 🏠 本地/局域网环境（默认）：
#    docker-compose up -d --build
#    或
#    docker-compose --env-file .env.local up -d --build
# 
# 🌐 外部服务器环境：
#    docker-compose --env-file .env.production up -d --build
# 
# 📝 配置文件：
#    - .env.local       : 局域网配置（使用 127.0.0.1:9300）
#    - .env.production  : 生产环境配置（使用 llmhi.com:9300）
# 
# 🔧 自定义配置：
#    编辑对应的 .env 文件，修改 BACKEND_API_URL 即可
# 
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
